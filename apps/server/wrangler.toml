name = "fightclaw-server"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]
workers_dev = false

routes = [
  { pattern = "api.fightclaw.com", custom_domain = true }
]

[vars]
CORS_ORIGIN = "https://fightclaw.com,https://www.fightclaw.com,https://fightclaw.pages.dev"
MATCHMAKING_ELO_RANGE = "200"
TURN_TIMEOUT_SECONDS = "60"
SENTRY_ENVIRONMENT = "local"
SENTRY_TRACES_SAMPLE_RATE = "0"

[[d1_databases]]
binding = "DB"
# IMPORTANT: do not point the default environment at production.
# Set this to a dedicated dev database (recommended) or leave as a placeholder and override via env.
database_name = "fightclaw-database-dev"
database_id = "00000000-0000-0000-0000-000000000000"

[[env.production.d1_databases]]
binding = "DB"
database_name = "fightclaw-database-bgciv"
database_id = "7589e184-c8be-4094-9130-f44723859eef"

[env.production.vars]
CORS_ORIGIN = "https://fightclaw.com,https://www.fightclaw.com,https://fightclaw.pages.dev"
MATCHMAKING_ELO_RANGE = "200"
TURN_TIMEOUT_SECONDS = "60"
SENTRY_ENVIRONMENT = "production"
SENTRY_TRACES_SAMPLE_RATE = "0"

[[env.production.durable_objects.bindings]]
name = "MATCHMAKER"
class_name = "MatchmakerDO"

[[env.production.durable_objects.bindings]]
name = "MATCH"
class_name = "MatchDO"

[[env.production.analytics_engine_datasets]]
binding = "OBS"
dataset = "FIGHTCLAW_OBS"

[env.production.version_metadata]
binding = "CF_VERSION_METADATA"

[[durable_objects.bindings]]
name = "MATCHMAKER"
class_name = "MatchmakerDO"

[[durable_objects.bindings]]
name = "MATCH"
class_name = "MatchDO"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["MatchmakerDO", "MatchDO"]

# Observability bindings for local dev
[[analytics_engine_datasets]]
binding = "OBS"
dataset = "FIGHTCLAW_OBS"

[version_metadata]
binding = "CF_VERSION_METADATA"
